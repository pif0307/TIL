# Node.js(Express.js) 서버가 POST 처리를 하다 멈춰버리는 이슈

파일을 업로드하는 기능을 구현하던 도중 서버를 열고 POST를 여러번 하면 서버가 발생했다.

처음에는 처리 속도가 느려서 서버가 멈추는 줄 알았지만, 콘솔에 문자 한번 출력하는 작업도 멈추는 사실을 알게되었다..

```
test console
test console
test console
test console
test console
test console
```

여기서 중요한 점은 서버가 항상 6번 실행하고 뻗어버린다는 공통점을 발견했다.

구글링 끝에, [스택오버플로우에서 같은 현상을 겪는 사람](https://stackoverflow.com/questions/66870275/fetch-api-post-to-node-js-only-6-times)을 찾았다.

우선, 해결방법은 매우 간단하다.

**서버에 POST요청을 하기 전에 response를 보내주면 된다!!**

```js
res.end();
```

- 왜 response를 보내야 하는가?

response는 요청에 대한 대답이다. 만약 POST 요청을 보내고 response를 보내지 않는 것은 마치 친구가 나에게 "내일 같이 밥 먹지 않을래?" 라고 문자가 온 것을 무시해버린 것과 같은 맥락이다.

내가 친구에게 답장을 보내지 않으면 친구는 답을 받지 못해 내일 나를 위해 저녁 시간을 비울 것인지, 비우지 않을 것인지 애매한 상태에 놓이게 된다.

이와 똑같이 인터넷 브라우저들도 서버에게 POST 요청(문자)을 보낸다.

그런데 우리가 response(대답)가 없다면 인터넷 브라우저는 POST 요청을 끝내야할지, 끝내지 말아야 할 지 결정할 수 없다는 것이다.

앞에서 왜 항상 6번만 실행하고 서버가 POST를 받지 않는 지는 이와 같은 맥락에서 온다.

필자는 크롬 브라우저를 사용중인데, 크롬 브라우저의 동시 요청 제한은 최대 6개이다. 따라서 서버가 멈췄던 것이 아니라, 브라우저가 POST 요청을 하지 않아서 서버가 멈췄던 것처럼 보였던것이다.

그래서 만약 크롬에서 6개의 요청을 보내고, 브라우저를 종료하고 재시작 한뒤 다시 POST 요청을 보내면 크롬 브라우저에서 요청 기록이 사라져 다시 POST 요청을 서버에서 받는 것을 볼 수 있다.
